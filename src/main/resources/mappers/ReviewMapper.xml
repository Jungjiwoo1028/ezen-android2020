<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="ReviewMapper">	
	<resultMap id="ReviewMap"
		type="study.team.abuhae.model.Review">
		<!-- Beans의 멤버변수(property)이름과 대상 테이블의 컬럼(column)을 연결한다. -->
		<result property="revno" column="revno" />
		<result property="who" column="who"/>
		<result property="rev_rate" column="rev_rate" />
		<result property="reg_date" column="reg_date" />
		<result property="contents" column="contents" />
		<result property="momno" column="momno" />
		<result property="sitterno" column="sitterno" />
	</resultMap>
	
	<!--mom 회원 리뷰남기기 -->
	<update id="editReview" parameterType="study.team.abuhae.model.Review">
	
		update review set who='m',  rev_rate=#{rev_rate}, reg_date=#{reg_date}, contents = #{contents} 
		where who is null and revno=#{revno};
		
	</update>
	
	<!-- 후기 남길 수 있는 회원 조회(맘회원에게 지원하거나 맘회원이 지원) -->
	<select id="selectMReviewMemberList" 
	parameterType="study.team.abuhae.model.Review" resultMap="ReviewMap">
		select revno, c.accept as accept, m.name, mi.momno as momno, s.sitterno as sitterno, r.who 
		from review r
		inner join connect c on r.cntno = c.cntno
		inner join sitter_info s on s.sitterno = c.sitterno
		inner join mom_info mi on mi.momno = c.momno
		inner join member m on m.memberno = s.memberno
		where mi.momno=#{momno} and r.who is null;
	</select>
	
	<!-- 나에게 남겨진 리뷰 조회 -->
	<select id="selectSReviewList"
	parameterType="study.team.abuhae.model.Review" resultMap="ReviewMap">
		select m.name, s.sitterno, s.si, s.gu, s.dong, r.rev_rate, r.reg_date, r.contents FROM review r 
		INNER JOIN mom_info mi ON r.momno = mi.momno 
		INNER JOIN sitter_info s ON s.sitterno = r.sitterno
		INNER JOIN member m ON m.memberno = s.memberno
		<where>
			r_who='S' AND r.momno = #{momno}
		</where>
	</select>
</mapper>

